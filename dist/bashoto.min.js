/*! bashoto-js - v0.0.1 - 2014-11-13 - Buck Heroux */
(function(){function o(o){"use strict";function e(o){var e={error:function(o){console.log(o)}};return o.position&&(e.position=o.position),o.permisson&&(e.permission=o.permission),o.timeout&&(e.timeout=o.timeout),o.unknown&&(e.unknown=o.unknown),o.unsupported&&(e.unsupported=o.unsupported),o.error&&(e.error=o.error),e}var r=o.Bashoto=function(o,r){return r=r||{},this._appKey=o,this._errorHandlers=e(r.errors||{}),r.locate&&this.locate(r.locate),this};r.HOST="bashoto-core.herokuapp.com",r.PROTOCOL="wss://",r.HYPERLOCAL=Math.pow(10,2),r.LOCAL=Math.pow(10,3),r.SUBREGIONAL=Math.pow(10,4),r.REGIONAL=Math.pow(10,5),r.CONTINENTAL=Math.pow(10,6),r.HEMISPHERE=Math.pow(10,7),r.GLOBAL=0,r.prototype.getAppKey=function(){return this._appKey},r.prototype.setLocateErrorHandlers=function(o){this.handlers=e(o)},r.prototype.locate=function(o){var t=o||{},n=t.range||r.LOCAL,s=t.success||function(){},i=e(t.errors||{});i.error=t.error||i.error;var a=this;navigator.geolocation||(i.unsupported?i.unsupported({}):i.error({message:"The browser does not support Geolocation"})),navigator.geolocation.getCurrentPosition(function(o){a._geo=o.coords,a._geo.range=n,s()},function(o){switch(o.code){case o.PERMISSION_DENIED:i.permission?i.permission(o):i.error(o);break;case o.POSITION_UNAVAILABLE:i.position?i.permission(o):i.error(o);break;case o.TIMEOUT:i.timeout?i.timeout(o):i.error(o);break;case o.UNKNOWN_ERROR:i.unknown?i.unknown(o):i.error(o)}})}}function e(o){"use strict";function e(){}function r(o){var r={message:e,open:e,close:e,error:e};return o.hasOwnProperty("message")&&(r.message=o.message),o.hasOwnProperty("open")&&(r.open=o.open),o.hasOwnProperty("close")&&(r.close=o.close),o.hasOwnProperty("error")&&(r.error=o.error),r}function t(o,e){var r=$.param(e);return n.PROTOCOL+n.HOST+"/io/topic/"+o+"?"+r}var n=o.Bashoto,s=n.Topic=function(o,e,n){return n=n||{},e=e||{},this._url=t(o,n),this._handlers=r(e),this._socket=this._bindsocket(),this._openqueue=[],this._ons={},this};s.prototype.publish=function(o){"object"==typeof o&&(o=JSON.stringify(o)),0===this._socket.readyState?this._openqueue.push(o):this._socket.send(o)},s.prototype.close=function(){this._socket.close()},s.prototype.isOpen=function(){return 1===this._socket.readyState},s.prototype._bindsocket=function(){var o=this,e=new WebSocket(o._url);return e.onopen=function(e){for(;o._openqueue.length>0;)o.publish(o._openqueue.pop());o._handlers.open(e)},e.onclose=function(e){o._handlers.close(e)},e.onerror=function(e){o._handlers.error(e)},e.onmessage=function(e){var r=JSON.parse(e.data),t=r.msg;try{t=JSON.parse(r.msg)}catch(n){}o._handlers.message(t)},e},n.prototype.subscribe=function(o,e){var r=e||{};this._geo&&(r.lat=r.lat||this._geo.latitude,r.lon=r.lon||this._geo.longitude,r.range=r.range||this._geo.range),r.global&&delete r.range;var t=new n.Topic(this.getAppKey(),o,r);return t}}var r=Function;new r("return this")();var t=function(r){return o(r),e(r),r.Bashoto};"function"==typeof define&&define.amd?define(function(){return t({})}):t(this)})(this);