/*! bashoto-js - v0.0.1 - 2014-11-12 - Buck Heroux */
(function(){function r(r){"use strict";function e(r){var e={error:function(r){console.log(r)}};return r.position&&(e.position=r.position),r.permisson&&(e.permission=r.permission),r.timeout&&(e.timeout=r.timeout),r.unknown&&(e.unknown=r.unknown),r.unsupported&&(e.unsupported=r.unsupported),r.error&&(e.error=r.error),e}var o=r.Bashoto=function(r,o){return o=o||{},this._appKey=r,this._errorHandlers=e(o.errors||{}),o.locate&&this.locate(o.locate),this};o.HOST="bashoto-core.herokuapp.com",o.PROTOCOL="wss://",o.HYPERLOCAL=Math.pow(10,2),o.LOCAL=Math.pow(10,3),o.SUBREGIONAL=Math.pow(10,4),o.REGIONAL=Math.pow(10,5),o.CONTINENTAL=Math.pow(10,6),o.HEMISPHERE=Math.pow(10,7),o.GLOBAL=0,o.prototype.getAppKey=function(){return this._appKey},o.prototype.setLocateErrorHandlers=function(r){this.handlers=e(r)},o.prototype.locate=function(r){var e=r||o.LOCAL,n=this;navigator.geolocation||(this._errorHandlers.unsupported?this._errorHandlers.unsupported({}):this._errorHandlers.error({})),navigator.geolocation.getCurrentPosition(function(r){n._geo=r.coords,n._geo.range=e},function(r){switch(r.code){case r.PERMISSION_DENIED:n._errorHandlers.permission?n._errorHandlers.permission(r):n._errorHandlers.error(r);break;case r.POSITION_UNAVAILABLE:n._errorHandlers.position?n._errorHandlers.permission(r):n._errorHandlers.error(r);break;case r.TIMEOUT:n._errorHandlers.timeout?n._errorHandlers.timeout(r):n._errorHandlers.error(r);break;case r.UNKNOWN_ERROR:n._errorHandlers.unknown?n._errorHandlers.unknown(r):n._errorHandlers.error(r)}})}}function e(r){"use strict";function e(){}function o(r){var o={message:e,open:e,close:e,error:e};return r.hasOwnProperty("message")&&(o.message=r.message),r.hasOwnProperty("open")&&(o.open=r.open),r.hasOwnProperty("close")&&(o.close=r.close),r.hasOwnProperty("error")&&(o.error=r.error),o}function n(r,e){var o=$.param(e);return t.PROTOCOL+t.HOST+"/io/topic/"+r+"?"+o}var t=r.Bashoto,s=t.Topic=function(r,e,t){return t=t||{},e=e||{},this._url=n(r,t),this._handlers=o(e),this._socket=this._bindsocket(),this._openqueue=[],this._ons={},this};s.prototype.publish=function(r){0==this._socket.readyState?this._openqueue.push(r):this._socket.send(r)},s.prototype.close=function(){this._socket.close()},s.prototype.isOpen=function(){return 1===this._socket.readyState},s.prototype._bindsocket=function(){var r=this,e=new WebSocket(r._url);return e.onopen=function(e){for(;r._openqueue.length>0;)r.publish(r._openqueue.pop());r._handlers.open(e)},e.onclose=function(e){r._handlers.close(e)},e.onerror=function(e){r._handlers.error(e)},e.onmessage=function(e){var o=JSON.parse(e.data),n=o.msg;r._handlers.message(n)},e},t.prototype.subscribe=function(r,e){var e=e||{};this._geo&&(e.lat=e.lat||this._geo.latitude,e.lon=e.lon||this._geo.longitude,e.range=e.range||this._geo.range),e.global&&delete e.range;var o=new t.Topic(this.getAppKey(),r,e);return o}}var o=Function;new o("return this")();var n=function(o){return r(o),e(o),o.Bashoto};"function"==typeof define&&define.amd?define(function(){return n({})}):n(this)})(this);