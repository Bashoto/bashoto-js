/*! bashoto-js - v0.0.3 - 2015-01-16 - Buck Heroux */
(function(){function o(o){"use strict";function e(o){var e={error:function(o){console.log(o)}};return o.position&&(e.position=o.position),o.permisson&&(e.permission=o.permission),o.timeout&&(e.timeout=o.timeout),o.unknown&&(e.unknown=o.unknown),o.unsupported&&(e.unsupported=o.unsupported),o.error&&(e.error=o.error),e}var t=o.Bashoto=function(o,t){return t=t||{},this._appKey=o,this._errorHandlers=e(t.errors||{}),t.locate&&this.locate(t.locate),this};t.HOST="https://bashoto.com",t.HYPERLOCAL=Math.pow(10,2),t.LOCAL=Math.pow(10,3),t.SUBREGIONAL=Math.pow(10,4),t.REGIONAL=Math.pow(10,5),t.CONTINENTAL=Math.pow(10,6),t.HEMISPHERE=Math.pow(10,7),t.GLOBAL=0,t.prototype.getAppKey=function(){return this._appKey},t.prototype.locate=function(o){var r=o||{},n=r.range||t.LOCAL,s=r.success||function(){},i=e(r.errors||{});i.error=r.error||i.error;var a=this;navigator.geolocation||(i.unsupported?i.unsupported({}):i.error({message:"The browser does not support Geolocation"})),navigator.geolocation.getCurrentPosition(function(o){a._geo=o.coords,a._geo.range=n,s()},function(o){switch(o.code){case o.PERMISSION_DENIED:i.permission?i.permission(o):i.error(o);break;case o.POSITION_UNAVAILABLE:i.position?i.permission(o):i.error(o);break;case o.TIMEOUT:i.timeout?i.timeout(o):i.error(o);break;case o.UNKNOWN_ERROR:i.unknown?i.unknown(o):i.error(o)}})},t.prototype.jwt=function(){}}function e(o){"use strict";function e(){}function t(o){var t={message:e,open:e,close:e,error:e};return o.hasOwnProperty("message")&&(t.message=o.message),o.hasOwnProperty("open")&&(t.open=o.open),o.hasOwnProperty("close")&&(t.close=o.close),o.hasOwnProperty("error")&&(t.error=o.error),t}var r=o.Bashoto,n=r.Topic=function(o,e,r){return r=r||{},e=e||{},this._handlers=t(e),this._openqueue=[],this._ons={},this._bindsocket(o,r),this};n.prototype.publish=function(o){"object"==typeof o&&(o=JSON.stringify(o)),this.isOpen()?this._socket.send(o):this._openqueue.push(o)},n.prototype.close=function(){this.isOpen()&&this._socket.close()},n.prototype.isOpen=function(){return this._socket&&1===this._socket.readyState},n.prototype._bindsocket=function(o,e){var t=this,n=r.HOST+"/io/topic/"+o+"?callback=?";$.getJSON(n,function(o){var r=o.response.url+"?"+$.param(e),n=new WebSocket(r);n.onopen=function(o){for(;t._openqueue.length>0;)t.publish(t._openqueue.pop());t._handlers.open(o)},n.onclose=function(o){t._handlers.close(o)},n.onerror=function(o){t._handlers.error(o)},n.onmessage=function(o){var e=JSON.parse(o.data),r=e.msg;try{r=JSON.parse(e.msg)}catch(n){}t._handlers.message(r)},t._socket=n})},r.prototype.subscribe=function(o,e){var t=e||{};this._geo&&(t.lat=t.lat||this._geo.latitude,t.lon=t.lon||this._geo.longitude,t.range=t.range||this._geo.range),t.global&&delete t.range;var n=new r.Topic(this.getAppKey(),o,t);return n}}function t(o){"use strict";function e(){}var t=o.Bashoto,r="https://bashoto-arcade.herokuapp.com/api/leaderboard/",n=t.Leaderboard=function(o,e){return this._opts=e||{},this._url=r+o,this};n.prototype.push=function(o,t,r){if(!o.name&&!o.score)throw"Score object must contain both attributes 'name' and 'score'";var n=$.extend(r||{},o,this._opts);t=t||e,$.post(this._url,n,function(o){t(o.response.leaderboards)},"json").fail(function(o){throw JSON.parse(o.responseText)})},n.prototype.pull=function(o,t){var r=$.extend(t||{},this._opts);o=o||e,$.getJSON(this._url,r,function(e){o(e.response.leaderboards)}).fail(function(o){throw JSON.parse(o.responseText)})},t.prototype.leaderboard=function(o){var e=o||{};this._geo&&(e.lat=e.lat||this._geo.latitude,e.lon=e.lon||this._geo.longitude);var r=new t.Leaderboard(this.getAppKey(),e);return r}}var r=Function;new r("return this")();var n=function(r){return o(r),e(r),t(r),r.Bashoto};"function"==typeof define&&define.amd?define(function(){return n({})}):n(this)})(this);